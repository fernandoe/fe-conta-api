language: generic
sudo: required
services:
- docker

env:
  global:
  - secure: cENfok7I0t8/rv76uptYLzdRujhcrkoJ3lIo5L+Q2iFrCVaS2wL0k+UVrfGH0Vo3UexD9e3y/7OR9ClS2eniB7eYO0tSlCoknqxBP1jkQpqjKFaPPtNL3OAnOlGdJY3xSqBznJuVrZjh9sfJQMnO3ckcxexLgmwUo00e2PdppOGboEDm89ulIRz5axgu3mWFTBF9+s03JITMc+UaSPZ2ckJmBXCwdvIAA6Eortb8tnofM4CVCFkDGRZmWd8pdXASY1RASWeD5JchmUL94+AC98Es90ze1M29nIwzjgWIS3xjJa+er10e0k+mM4NhXPApSY2J0I+NWKdDMYcb8fzldHx4ytO6SPJO/3mDW94LhH68sTOc2kpryCK0e2B9bGau3uEP4Rh6a6xZp1ql6qYVykpz9hlM5owDSSnlJB9KVQVedpBozbrQ96R5PKd3cmHuP9+RaYbpDzXfVoFGjPByBD4vued4lQQUp77OxKOp55XQMbxkZiH5LY11k1Lx1BSZCdZ+GeBmxWRJzjPosu8o/Qg6w5YC8LA3DS/ATXriLnq5vv9FlgB+fXv6afuEULM0GYXel5fO6Z5Gh8brMxK7VGlG8khmNMB+DasjuOHzWNFuz/FIRSDy8nz2FutNpL1vUqamm14wnWr5L3NNuohaADq/0cxzM3F3LdNgmy22ydc=
  - secure: nl7XN+nFjCHJ2FyP6eL+p5MsJw1SuSAf1VTVOQSsLPxHUYvqGVGg16HouGibHh5xs5NV1dGeMSCSZeM8j/jyg2y05zRz6qqC5eTAAzLrtE7SodhS7bK/p/Tksw2MJAbp4Et/7kea/8wVbGQGRxs7dNwT9T2AKKZPM1k+ycR06OR4U7TIaVOVXmFGX8BMnRzpCZSc5+5qJ/mHB3n5OSJrliTd4VcmI40QPvOewkmzZzIel39nWaJ0T0s48OSbxgDtwIRwsOm2LmUUzJx1htVEaNUIzd3hWbfGRFhfeYXZU+zbMqBtDhGD++Ai2Sx2s4QPIpXWB2iMo7U+TeYVh3kytfmCbVzkuS9xywZfUnNJ5/Avfn7cPqyuO9hX7oDZ4/iPYJcs/jhH0FdZZ4EogQOSHoR8tATsAh44kmYc17ALzmCbkEHfpVb8dPGtEk4czGmG5zkd82s1B6MRb7TrviNC5k8hLOonaUeSrWfdsRWHma+Xl6FkTAhM0u0TS3SClgMnj6gJACq4Xq7Ee0VK2PHswQjHiWzUVHbU1Sa97DOhFqEhSSkuUbNnyVvx7iuIOEM/kxq1+l5LBIvItKvJiM/anDPTNumV5JReu2ZfoBUWlXb2e+DB7RYSoUn0n4gopka3q8gZ8GZ41JRgaLed2E/2+38GYvzrRc/lsHgla1lAE18=
  - secure: a7wNQa8YPfS20WhySuLX4R5tYERW2ZksJE//4M0Z1PBdggDy2gpljvyFiGNWrkKKC+FKkkd6YlcDUIFYOZVZLf0tylSGHMLJ2FhoI9nz5k4OFMA1He2lI9SxrGRQqfyojZHfDKJzp+Op64cmcFZk5lxC7sRPmjombupfhyiL+mQ3gGdRioBjQ8KiOBtW6RUcSTtLBPP9hT10Pal3f/zvQhCTbhZFV1N2jw/AY39gIlv1NgtmnYKvtnadm4t3MrTGbDfDrxqHmHPLE4C3+yabHR9HGOHlq2oItK+P72subbvGLsAIFSQY0wfG0P6Jp/5DUdZtYBPRdEDhaDaitv4GKy2f/T1mEa8YClVQmlEdDu4v7nxevhWBwzR9+hBX/JVoPtgdl9DvaCnCCP3oJz0aCR2qt0jU2e6/pV0U2jX+HxQoNhHwVL4QfegY6Lil1WTzAHkJ1meV3mQX1jO1d/QHQmpeaxagYmI4+m0lTpui/q1w3gXOERp8ZtZQ5pPnTvf5yuhBPILx8FKemMrmhHys68mdrFbLkiVDiE0p2Wbs7GdHW35VJupeDNB/zmuoFA+5pFWYKziwWIuyl4Z9/U4Tc+9KcqTFMYRbng92WwqmR7xeWXfrxJA7F5pAH4jjDQRA6ZnASVZ89cagclTSo2j+Q4R/qyT2+88LircH2E3N2KM=
  - secure: HkEhZr5BeEeLUEysDCtDroni68uDbgcB9cUEP9azwXziakb36/zxLU7ZIviGz4xo0IOP5hZfGrmBxVgEQFtFj54eI/XImGSksJXbY6H29eXxI1hELsw5r6TrvrRAczzkY69NokVc1IaFy6k+va1+YDXu61ZXYS2ucpTe5FeFCCjF/h723I/H/fn6QtzU3SaOeBTb6LMSJCt50pEbNs3j2mkI/p19HfQ1widnrCDl1rYeICo9Uu0JCInZVEhTD5JEEvZdQJD0vN+WJtpZISBPTEuhFTFfui/l/Ca8Uqfp9dFxFpa9m+WgiShnoUDCEik8zTSLtcKGdG1H5KNBTevvNpzLTBR7Rs18StIVKVrdC3Mh2NAcL2fddw1q7XNVU83WqO7C2Ki/4s4gWInDiKJI2cIAOCtoDKyw5GvMHR9zBP8JnlQNF58mSi82EvKOdbO5ST6pOKncJL8LA/0sk10Ih1zyY2g/8SvNT1i4MB1KKUfeDhp0YSNW6F/1TfoSapxovd0WVFtI+/g5n0lRJ3ETZQRM+lptijbCe7YWBO4yxu/P1Ud7ly/7iZg6DEkqsWZ9ho5rm39YvX+tiG1f1OvgKbyJE2kqv5Xkx4DAaZia/AbfQfwsp/Q0+9yJFrvTnARyRgg8CPkB/HHNcWOIQoLqd2Dwj2JoL5+7bNjthzmngU0=
  - secure: KEuICFGz5Lip6UHWJ2HiibufaENykZO3/GQto+PjsSvgNFtHy+y4zEmH0lk+yQ0j7qxMDJDSnqthIfGPVdcn6jSqsw1tgumwLcKpcvr0VhNOegA0p+JHJscFQi40vau0IgOypt/l8GyW9sEqHphgfaCzgyVfp4wlcYtNL8DKKQujY4nbg4audmQGfXNQazYqk1E51Ueb8JMxeXElrRW4+OS8ktO8iA5Pm+gsuJzMQm0bbBS8tj2cbIeHrqSHmwFI5up69N1t4xgOmU8JgvfspW57LWg3aXNSeVF6dwwdI9VgECng4ud/d1E2brH0Qjl59PDVfDmtQqHLC/hID+T0Mzbq/Vr7+qkCfgZEmmIggiImcR7XaF5ygmMnAXN3CT5Q+eLYrGQjYQfGuJbO3CjGCCt7gJ9FV7zprxUnqDKjb8XjEZyqyULKzbbOCfarHmLCkBz046+knwYZxplUXed75fQWzm2wvMqcNHeos0YyhdPSNKKHcgXuQOmlqobYGKEImlnzeV5Ns3AE4pWMntfsA5ID+b4Uc0nRRDUT+kyLksM7YWE/eT8M2nP0BjT0ZFbVw5vCfdOjefIXa7KTAgQLea8mZ8JsdM7CcIH4dxgVMuLq5R92R/+aSw3hLvrcCk4+SXMGztLpN5Y5xsCpmZAZSQ3OmDTQ96zc371HUB++Yz4=
  - secure: BR4G/gslAKqPchOZYAvC7AtHoJNLwcO54I6tT4U2wwwAgLYWAKboItE+wXYaoDcm+lRl7igxzVYL4wqEd9Lz4Fi+vHjENrBa8CB7Pw2loGSJari16dASwEDRHn1IScS62tMzYJ3VYCpaijRT+9C8KWTdSRGUfm9VxcHiOQkbppExpInIyRVy+LzwyFHXrQEtInX0FMcclc/fzQ5aIpDiZ0m/8y6mbJ5lKnTME/sBOrQA4dg+WzHCMusZ4kzWP9nrAaOlx9lufXgHcN3OpHvLcrv+rP2WLjqQGDhMz2DeNUPOegy/v6Rgf7CAyAT1XFUU4G9dFj8PxE0HMzmErMDL8fd2pB7XKCF/EwiksPo5GrpLdLIQRw6vMxhFUHdl9XlA3IMlXEH/3O9VpDA4ku9XwBCBQ81wT58o97QjbfMmy65GdjSVBdIr5UlL+kcHM6x9xsWFOioPTSb3w8ecJUAQ9y6vyOSTU/Xss1VaOEJNoG7tk/YkErEu8am8SFXWYYl2MMWbExCcqjmHhfSd8udXuQmsQyp0NF9dKFXFzDs+8jiKlSl8aVUb38GrFPixjPTx/lwv2hlpDAlHznFJEJ75lFGiHmiCMJpS//D6iUWzlTd3WY5A1841N6w1BHwOHNxiVnZBOgVz0Kk6ZnPnkRcJznLOifDWR0i0az9ev3+aLP4=
  - secure: fUuUQYhc2IPy2OysSZdZPHo0GUe86QJiuohOnjA1Dcwrrr3qxfiFOgDJ5+OWjd2j7/VuFlFic8ks+G+6V+UZZoksDLHS340rwMX7DDdIQDaoAokMfNj8N/9Enwnpr5Jbff8Ec4Ej6oaJjceB+gHPe+1tIVEvm2m0IzZ00Nn6JTKqK5BsMv7HUCUuATubClTnTgunRl6A/aHNCPzgYCd6qaFsVvAwvX0VHTHgkP2z68hw2qEKg7DXywMyMm0EyV7X4gBQgNq7tX5KbkxdnTJ7YNCXZs6TGV+rH8OCnk2fNengxYOQlNTOmYlv7HfP9ho3gBYTuEySBBvY8K8TLOiCpOymyc/r3KzYMbob1OiEziYu9UwM2T1c9nwVpyRM80SCnV5f47e0+HKt3At8h1kIjGzLCbLdFUFG8oCJoHaAL/LNWfAk10WjMBVeL9Pz+oz9GlTOaz63JxgKjY9S5zUdj6Vz3rE9bCPeYo9C0rw2uIGAxL3UqW6z/JyotwwrGJUjPU9WSKFACu3TdBUYM1slpFNyLkn/72UXVKry9Ul1giQyrDfx+osmSOTsgt/lpM2xoIxoTuwLbdkFfMErSBYecE8QRKj8wT+H5LdffybN5soImTriv1kDXMq+XPN15wciHhOU/1ObjEw3d3raYG5CRo4JfBLg0082ikqE2wRQ2z4=
  - secure: SidX5mKasn5cbsOdCs4s1z1oUmZpiavVytqOim0S+29i/UmlwYS9CJ8aO8sRdlKTtUg1x3b9miSEGi5mhCno9JeUg5k2qzX8oZ8h0OUAunW9XGhmXi+/aOb4AgqsDomaCm3dQLLfBO8Enw5zPR/ejeYfLwfq06NlgxFC92vE+gCRBzTKSq9zrjyhZgpy3DKQfZ12+mZIfep7pPjcT+LKUZNW01piG5Bxma7N9/mWp63UUF25pX1cdMVzTkGiIYwSo8tHF9+KlD28PTDz/jS9aBbJdjTFX0/eK4WaKRRwtXDjvUPluGay3tD/2I4fnCk+9q6SoXY8t76PHlJ1OXN/BMBDWTDwEEwMkmpFqH2yFx8/4SFSpLrQbZH8tgJcf5PXSxwXkDwBZ/RNQ0mBRvPkCogtihp2yP745IJjseJa0a0azLQtOCCx97R5gMxpXcjFc7DUyXZqwcZjOOZ40dw+iMgbvtcL0CALAz1F1SsNKblHPh3ghfwHYzHS/eL0zKJhUh4qGY4rxcvCylhsSu7YWHk9OSe29a3gJqPMJBYAv1a6XfIIXf2QbSQ6aJqY8mXuNLWQk4MHNMmruCKZa8ZHXSpf1Hxyq+AouZ8Qzh09W+vUvY17pHH+2/AQrEes5FrRscylFKKD48DxTR+Niqw8j5vZgNbjYK/A3nT4FUfYyrM=

before_install:
- echo "$DOCKER_PASS" | docker login -u $DOCKER_USER --password-stdin

install:
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
- docker build -f Dockerfile -t $TRAVIS_REPO_SLUG:$TAG .

script:
- make travis.test

after_success:
- docker push $TRAVIS_REPO_SLUG

deploy:
  skip_cleanup: true
  provider: script
  script:
  - "./scripts/deploy.sh"
  on:
    tags: true
    branch:
    - master
    - "/(\\d+\\.)?(\\d+\\.)?(\\*|\\d+)$/"
