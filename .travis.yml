language: generic
sudo: required
services:
- docker

env:
  global:
  - secure: zEU4YRhwcZUhWaVsJzBE5GI/ywbH0XshCbPcBaTKDrGdVRwWePoxOPkY+6T3rmfamSqSgRYer/A010hv8DdTOvqkpTG7ZOqLTekmdBWrQr4JuDuCPzn6qkBi3KtNgztiMBFrm0ps8fmyZa12dmyjY3Y8CIIPCtMFynuRggTd6MNB75mPTPiyspgSl1ELcoJLrEWtAYK8to7nFJppXa6MYzIZjcKbHPRnVGYigzh/zpmBuuqEfxcV9YdKc3T8+1w053WWRoasMmTcD6nGGWynHrXuhD2ciwg1hd0+qhlvhKSNobMLbozf0V4bx/GWlOBpmP1flNOXprReDO+9m6A1+FKGEn0iffC+HAFppimlcAw3itrv48BGF71aeYgEOxFV7WwvD/v81HtJ+A4wUzFur6XZJDIJLbcfGBEvILAX1w7yjhiq82mNb97SB6ZmRiBvyjrHl97hg7udDBLeBn+MC31IncAwXnsR44+xGJvxf2KQmaxsCiEzKzmpDnuTQ7LmyQjsokTxwFhMf14/nMqQANUOpRnUhcYP3zTO002og+RZv/M2kVnb1Op8h6yugAD7XM8GcGRE82iUcGJ9mA03ra4DezYRfB5adjEu4j+4vksRNDLoqzArE2TIqB4HEONWSMKmKxgfksmvnAF5OJFP8/sx85FbPw9kCF13HcrE+uE=
  - secure: DLUGkbeWu390TA2Qsj/U6C/K81V2nRZ/+mwte3dEibN5BU970Vx5rTM8IF7NPyqg8hkFelk0i/4p8FHQWwt8W80JSABvOHK+7KBFSpiY29ExbMDuyBnL+IX1aPwwCbtKk5BJyd5x0WGbHciq1YLXqcjWyS3JBFWjrbLmKIhHeCLQ0hKmdUdqzAUUGQ/mvtRz9qkkJBcrHM+USDjtQhRsN61skgztk9ExOu5I7H/6e+QaJecxjp8ZWD4ORUu1XELsNRlH7AgNpESOyV3o47xaPfSnDdZQleKi1txrsW+yAgUDtsH754UyRddmKLNG3JPeflm2F0/bZQe/feHX1nFuwo6YuHd4OgzzBb2LFkl8Z05jcja3HvmPIKOwS6yvAuU0EuDWQWruvLJJ4GfvBa5HRkAzHnMN2msVfZEasESIl2bcTUc+GLQ7UwPuVw+CUfrTR7cJp/OgYcuKkYHi9Lz3++uHgEhkWtl1Tu03qhTpQgRI7/E0LNp6HhZ0YCSxKANi1bVruKoc8Azi9XetyFQsZ+BMVeNqKxc7wRovAOPJ6kOZrr0FMBv30ohK9y7k2xzRqhnMv4tb4FBfyXbc9+RBB6pSigCjtVD7YehTlJ+VHwSkxH+i2dbOEv1cSUs60R1sm/1DRxc/mgat+Mekm4Wx+PwqypbrLGrKkpNHjqR5N1E=
  - secure: GJMfJAHoJveRyTl2QPxqm+fBcaL+3+LALPVfSOM1TuVaKJEA5YY8Y/PSCwC4P1sMLsKrQuFUiKM3MtoheNzZRRqWLao8h3thSSHy/lPjpsfH7W/xMgvTRPvG0xLbD0BZOchnbjDUjNNBFio9DST9iQwHKRU5yq10mCAKeRRIbTPLRbSjfUnS1KWdnPphFQBFQxkgbxJvCuo9rq2S2ZRE3tPH6mMqzNfcNdEJrNU0NsFRlBxSlPg4EKT9MWX3Qwkut2+qsqDgkcScYI/oIFLR/KG0TO7xBrNAJ1W1oMySln/OHCP1RCejz1FjxTPyqbywCbiKabZa4kJIYItOs4alR/AUFndJ/ne1+EW6Y4dbPqWiucZIZWgL86ZgHYROX7IAs7V58H0B3jPMcn8YIlAm8HFyH8vjhYU+fRwKW1r5jZflVLhSZzc1NFO0JwD+CadRu40iFP/2YhndBt/m3QkHUiQgJ/wDkJuCcu77+jKRqRuaedAzJMHiKgerPjQ5Dk6JmRJ33s04gEFMj0wbq33XTuP2ElwmAuDMsfZtSsJBWyDX1Hw4YfA6+P/RrNlCJEWywiV2Zid2wR+7uH6yNp5sjDrEigbleKsCiMKmmB+ZUl9HTOrq3Dmekze2t5P9TnGMX/PQAnHzYkK9SR4Ho1fnEgis+jmu494E42qeqQJ47Mk=
  - secure: zu/xBOjJTQK7Jaa5v3WTjgjQ10CsO9DuC6v+blqaIiIF+qWzfXUuXudBlZc2Lf/Gcf8yXIE43gq4FC19slQ3Rkrmx49ByAKJxeiz0e36tsh1BkRjw6njC417nx7ZvIv/GOIlD2Y+qxIofZesd9UChQII+GeObwQJwtbXW66kalJV0a+ALe4SifiTs9gcEmXP+PBC6xuNZqwYGQdYKUznidcX6jSNWaId2y9Ab8BUQyUE+iVs/GG0F7hICfPVezs8MWLSLK/lAqjcqWMr8FsR/TanFURoYIG2d1BV5KSqSC3ICz3JlmXiM0bmA6vMiDwp3GyYhp47+R4u8l939yisnd7H5o7BybsCvZJ0uwDFKKa21epGxeY2q4bqZZBaD0J5Hp0XXvT9eEKDo6taZXPPInp1lY72ytRHgsKCAstXZypKGvH3bbutfY3tyk3DwEDNLQQ7FVRQLHkSKAlyPLF+PPfCCv0ljeD2nJ4b4d1EajroId5/ZdhwJs6jGHClTT/lWd5R42KlMuEtEhd0YMoZriBQyoHPADyrFiRvwhz8Mil9lgstElLGSybU48mY2oeMS21UT6gFQ6+u7MOwq5WP+oVdfGPeEFiPbSUH/dHvZ28afl+6kbrTj0ITsEN/Yn8/IR0SFpC7uuDFTRDCSUK8lmS8/N/T1vYWw53IP53W1yc=
  - secure: WGPEdFqwyFodY8vkLGg+rUI0bmm2qwtn4OoAS0ViQ4Boxn8/Mdp7JZGtn3ugu8VYEcdwEh+Zy0LboqFpkow+bPuQ4np6473F21VmaC2OoS+CtsQ+dWPPaP3Ql00VZDTJPV0zYOtRn+hzup/eZcalw4jsG3IaY88pSt94oqW6OHQNvFjIccOqRqBHqu5zliO/c7Y1f9s5Ky67d7fcM9B+KedfZ8YpU8UyQAZJ1qVf8ZaDuuwndKA6YXd2OUswPWOa2YQCIFRPhPjmal5fOARd5Q0OstwuFcpFdT2mX5ZNF812gz/hQkwbTqoBBp2SaE6NRcOa0/z7ca5FjlXeO3aJ8zffRaX1ZYjQagl094Aj35Dl2qpw4U6pKuQE61cDr6S5p1yf36h4dw9B63oWirRAE506r8iXe8nDMSHGDO0uV3EI01YCVm7x6Bpd95e+rENaJU6v7Dv7kFWLbpxLAuUjwCBbGDaUW+hd5uKJ6OCtcwf6+ZCRRUuZbQ5IetGetPJVWOAc6+ldPJRrR1rLH6RVU5coGUtKA4cxq1Wu6JQT9UK5TQvbbAJ6G19jRC81sgW1T9rSNAcXldUzcXspurRskhtp6yxCUAUQURWRZQZFAIVoEG4nOZQp0mHGfg79QwK2QklLQMdjQURL8VWz4/8VtysWvIQGLskxWhb4DrgIDwM=
  - secure: 238Qxxf4+/sXuutMY7BygBqM9Paiq+qS1ldQSNZR6AIL3/B5jayHI0E+bCts3fpBDf7higjdawRR/HVM7gyuey9gsj6RVrpJm9hyHRoxKaY+ExaRO+3DjWwO+d5vnT9KkTlwXstpES8k2u4qHvgeJVEWVuL4L60UUXX6sWR2lqJbA21FgfM/QlkMmDMUU2/jvWdSpoQrl0wSzNt7KJWV2n9wRhMRzfR+qHqoidbgQuiubeeS2pzA1PnXhxQ/mXSEspikRFTyg8x9IxH87jiz1lWrwRH+iw/mtDb/sT7ZaF8l4HrvVlYjFoaCdVq+htgbnbfttx3TpvM7cV0tgrdjcDW4mppQJR1YG2fx1xBUm7Tt8wTdtVu7g+BcM82fnusX1HTMsg5jpHMKl2yda+tD+ILC130G+fV+Ri+8/s4Y0HvY8zAkm2SlfazWYlzYyHmIteIyqeQSm08PEPrlVSJjJFSBFpmWNQLSAwhEPZ8wmephsX8ZGpuWqGagH4Tffe+LOIDiwkCektd/xRpJ+CmdHW78nFSoLnaykHg0ujjZHgIb1C7OD4dAD1R5LL8i2OZkMsurmYURO8EoolsmWZqV1VSqtG+haX4i4eprf7mxmo6MIpFKVqwNJNYmSfWNE76wUptsA3P3Ash9k2AKMXnsb4XhX5xnV70Q8UY5rSe9LhA=
  - secure: wTWOneQOdAlnK+3lzcsJfInTYUvLcUCyctwmZtTVstQath1F52hXaTOtzS4Df1NNm/EUo2IhgMJmed+gJJCC6DgboH24yS3ySx6kSzhF1aEfpNLyEHxQaBhR/K9LAyF5znQ9Te7fnlhp/LmNIwlGnMzffHZVsMNU8FcLwiIorC/va+PoGaruLxKVwo/dRtAI97vJTk7HQhyhd4xQJizKhyy7DP8JmsFmeTZGbi0AFOD11Xdw6BdZxyCUaczNI1TnXqA1N5R7aafw8cU3Ihd19GSfvdjB5zkp04wJCT+OOjt71eEyGPlbroGBWTnh/Oe1+bBg+2idy/dA98842kxdp9L0YFfHMgcqZUXFZypHmPVaJKb8jB2BkSzSZmfEJ+lY0Zx7OopiDtNWIWv0W07jKTCHjgRYtvZ/1/0zFMstHbhaRPtPKzrq8PFeBwPd2Jl97NXUD2oXj/dDRDtyI5u2lvi9B4fD/riLJ9pzeMACi1QoKb/qMtt1NNixRZoWRmlmHBSDOXG5wL13YCoGL6b86nznvHFcUMhCtSQWD7iQ3y+NeCp2XGLpAiKZi3hrFXawG1OAf1jOhTepRDjBoAZ+6YomsLiF9FBoMaCsNWE6z1AAf+6S6TiEb0JZBC7ZuxRQ0tpMKft7GpuyfUzEPVFqsIvQcJb4tWIx3Y1h3T8nYJg=
  - secure: LbwJPD+QnBycmZSaSeCmTkJBdHytV+Zv9Tz3TKX9kFJim8JTo+zJumtlaB/hvm6Oqo8F16rL1i0u+m8tk9vsTRE6ZpxbVOmnL5J095CX/J6Hn3JO1AWoSVfGdoZEnmfExOeiiklG8fEVn3pgpTWcLgupeCaplrmTfd1jMoYSeMX6LlQE62z3SYb5oi3x+YLhNqZWoywDOovhSwnn+vG7E2DBxcl0ajunyl0dEFzvg9n9T1fJjolIuftnlJB688EUnTlHZalrBWOtXimgh2yFVFSJvLEjfQHQQVbLGbUTczkIb3Byg3QmZSN0EgkaQIO3fvyJjFxHjCPDyKaLjwiGAYGeNc7pFV4pCZBJSoyw4WCBemibCbAqe7yFzpa5W+/oUnNRr8qgkQzFFKz1SLqioieY2/IUZcMMH6EZp3EF3mP8KQizu2TuIF7KIba2yOE4RWYu/yyzX1xpwZP7y5uQCV6nvrrxKHZ4opSvYnRo/f0ui0wnUPVCU7AF9SXltIJ0EDg0zKaFjRWoG0nd0NmvlNPDrWxHZDtyxEP+mXyBNYw7inPpFCmocwS6VqQKmuBRdi/htuHRA6I5LZnkZ7scDWw8plQzdD4jXT1dcYR5fb41iCcTvhpmn7q8TCzQQtZnfgVpTYAxMBIKoEcvW0vkU/0Ky5IbCJ8CuPHlhra/n3k=

before_install:
- echo "$DOCKER_PASS" | docker login -u $DOCKER_USER --password-stdin

install:
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
- docker build -f Dockerfile -t $TRAVIS_REPO_SLUG:$TAG .

script:
- make travis.test

after_success:
- docker push $TRAVIS_REPO_SLUG

deploy:
  skip_cleanup: true
  provider: script
  script:
  - "./scripts/deploy.sh"
  on:
    tags: true
    branch:
    - master
    - "/(\\d+\\.)?(\\d+\\.)?(\\*|\\d+)$/"
